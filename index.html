<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tennis Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      margin: 0;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #fff;
      text-shadow: 0 0 10px #000;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background-color: rgba(255, 255, 255, 0.9);
      color: #000;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      min-width: 60px;
    }

    button.participated {
      background-color: #4caf50;
      color: white;
    }

    button.not-participated {
      background-color: #ddd;
      color: #333;
    }

    button {
      border: none;
      border-radius: 4px;
      padding: 8px 10px;
      cursor: pointer;
      margin: 5px;
      background-color: #ccff00; /* Tennis ball yellow-green */
      color: #000;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    button.selected {
      background-color: #a3e635;
      color: #000;
      box-shadow: 0 0 10px #fff;
    }

    .summary-controls {
      margin-top: 30px;
      background: rgba(0, 0, 0, 0.6);
      padding: 15px;
      border-radius: 10px;
    }

    .summary-controls h3 {
      margin-bottom: 10px;
      text-shadow: 0 0 5px #000;
    }

    .summary-output {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
      color: #fff;
    }

    .button-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .button-grid.months {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
    }

    @media (max-width: 600px) {
      th, td {
        padding: 4px;
        font-size: 12px;
      }

      button {
        font-size: 12px;
        padding: 6px 8px;
      }

      .button-grid.months {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>
<body>
  <h1>Tennis Tracker</h1>

  <div style="overflow-x: auto;">
    <table id="trackerTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>V</th>
          <th>S</th>
          <th>F</th>
        </tr>
      </thead>
      <tbody id="trackerBody"></tbody>
    </table>
  </div>
  <button onclick="addDateRow()">+ Add Date</button>

  <div class="summary-controls">
    <h3>Select Name</h3>
    <div id="kidButtons" class="button-grid"></div>
    <h3>Select Year</h3>
    <div id="yearButtons" class="button-grid"></div>
    <h3>Select Month</h3>
    <div id="monthButtons" class="button-grid months"></div>
    <div class="summary-output" id="summaryOutput">No selection made.</div>
  </div>

  <script>
    const kids = ["Valentin", "Sebas", "Felix"];
    let dates = ["2025-07-02", "2025-07-09", "2025-07-16", "2025-07-23", "2025-07-30",
                 "2025-08-06", "2025-08-13", "2025-08-20", "2025-08-27",
                 "2025-09-03", "2025-09-10", "2025-09-17", "2025-09-24",
                 "2025-10-01", "2025-10-08", "2025-10-15", "2025-10-22", "2025-10-29",
                 "2025-11-05", "2025-11-12", "2025-11-19", "2025-11-26",
                 "2025-12-03", "2025-12-10", "2025-12-17", "2025-12-24", "2025-12-31"];
    let participation = JSON.parse(localStorage.getItem("tennis_participation") || "{}");

    let selectedKid = "Valentin";
    let selectedYear = "2025";
    let selectedMonth = null;

    function saveData() {
      localStorage.setItem("tennis_dates", JSON.stringify(dates));
      localStorage.setItem("tennis_participation", JSON.stringify(participation));
    }

    function addDateRow(value = "") {
      const tableBody = document.getElementById("trackerBody");
      const tr = document.createElement("tr");

      const dateTd = document.createElement("td");
      const input = document.createElement("input");
      input.type = "date";
      input.value = value;
      input.onchange = () => {
        const allInputs = Array.from(document.querySelectorAll("tbody input[type='date']"));
        dates = allInputs.map(i => i.value).filter(v => v !== "").sort();
        saveData();
        renderTable();
      };
      dateTd.appendChild(input);
      tr.appendChild(dateTd);

      kids.forEach(kid => {
        const cell = document.createElement("td");
        const date = value;
        const participated = participation[date] && participation[date][kid];
        const btn = document.createElement("button");
        btn.className = participated ? "participated" : "not-participated";
        btn.innerText = participated ? "✔" : "—";
        btn.onclick = () => toggleParticipation(date, kid);
        cell.appendChild(btn);
        tr.appendChild(cell);
      });

      tableBody.appendChild(tr);
    }

    function toggleParticipation(date, kid) {
      if (!date) return;
      participation[date] = participation[date] || {};
      participation[date][kid] = !participation[date][kid];
      saveData();
      renderTable();
    }

    function renderTable() {
      const tableBody = document.getElementById("trackerBody");
      tableBody.innerHTML = "";
      dates.forEach(date => addDateRow(date));
    }

    function createButtons(containerId, values, stateType) {
      const container = document.getElementById(containerId);
      values.forEach(value => {
        const btn = document.createElement("button");
        btn.innerText = value;
        if (
          (stateType === "kid" && value === selectedKid) ||
          (stateType === "year" && value === selectedYear)
        ) {
          btn.classList.add("selected");
        }
        btn.onclick = () => {
          container.querySelectorAll("button").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          if (stateType === "kid") selectedKid = value;
          if (stateType === "year") selectedYear = value;
          if (stateType === "month") selectedMonth = value;
          calculateCost();
        };
        container.appendChild(btn);
      });
    }

    function calculateCost() {
      if (!selectedKid || !selectedYear || !selectedMonth) {
        document.getElementById("summaryOutput").innerText = "Please select name, year, and month.";
        return;
      }

      const filteredDates = dates.filter(date =>
        date.startsWith(selectedYear + "-") &&
        new Date(date).toLocaleString("en-US", { month: "short" }) === selectedMonth
      );

      let sessions = 0;
      let totalKidsPerSession = 0;

      filteredDates.forEach(date => {
        const dayRecord = participation[date];
        if (dayRecord && dayRecord[selectedKid]) {
          sessions++;
          const kidsThatDay = kids.filter(k => dayRecord[k]).length;
          let costPerKid = 0;
          if (kidsThatDay === 1) costPerKid = 15000;
          else if (kidsThatDay === 2) costPerKid = 12000;
          else if (kidsThatDay >= 3) costPerKid = 10000;
          totalKidsPerSession += costPerKid;
        }
      });

      const summaryText = `${selectedKid} participated ${sessions}x in ${selectedMonth} ${selectedYear}. Total cost: ₡${totalKidsPerSession}`;
      document.getElementById("summaryOutput").innerText = summaryText;
    }

    // Initialize
    renderTable();
    createButtons("kidButtons", kids, "kid");
    createButtons("yearButtons", ["2025", "2026"], "year");
    createButtons("monthButtons", ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], "month");
  </script>
</body>
</html>
